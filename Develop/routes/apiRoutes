const fs = require('fs'); 
const notes = require('../db/db.json');
const notesArr = []
// use for deleting the note, app.delete 
const { v4: uuidv4 } = require('uuid'); 
const express = require('express')
const app = express(); 
// const router = require('express').Router(); 
app.use(express.static(`public`))//before express, anything in public to root level 

function apiRoutes() {
//3a)
app.get('/api/notes', (req,res) => {
    res.json(`${req.method} request received to get notes`)
    console.info(`${req.method} request received to get notes`)
    fs.readFile(`../db/db.json`, (data) => {
        let notesData = JSON.parse(data)
        console.log(notesData)
    })
   
 })


//3b) 
app.post('/api/notes', (req, res) => {
console.info(`${req.method} request received to add a new note.`)
//req.body is where incoming content will be 
    const { title, text } = req.body;
    console.log(req.body)

    if(title && text){
        const newNote = {
            title,
            text,
            note_id: uuidv4()
        };
        
        const noteString = JSON.stringify(newNote); 
        notesArr.push(noteString)
        // notesArr.forEach(createNewNote(noteString))

        for(i=0; i< notesArr.length; i++) {
            fs.writeFile(`../db/db.json`, notesArr[i], (err) =>
                err
                ? console.error(err)
                : console.log(
                `A new note has been written to JSON file.`
            ))

            const response = {
            status: 'success',
            body: newNote 
            }

        console.log(response)
        return res.json(response)
        }
}
})

// router.delete('/api/notes/:note_id', (req,res) => {
//     if(req.body && req.params.note_id) {
//         const noteID = req.params.note_id;
//         for(let i=0; i<notesArr.length; i++){
//             const currentNote = notesArr[i];

//             if(currentNote.note_id === noteID){
//                 let newNotes = notesArr.splice(currentNote,1);
//                 let newString = JSON.stringify(newNotes)
//                 fs.writeFile(`./db/db.json`, newString, (err) =>
//                 err
//                 ? console.error(err)
//                 : console.log(
//                     `A new note has been written to JSON file.`
//                 ))

//             }
//         }
//     } 
    
// })


}


module.exports = apiRoutes(); 